<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="计网网络层重要知识总结">
<meta property="og:type" content="article">
<meta property="og:title" content="计网-网络层">
<meta property="og:url" content="http://example.com/2022/02/26/%E8%AE%A1%E7%BD%91-%E7%BD%91%E7%BB%9C%E5%B1%82/index.html">
<meta property="og:site_name" content="元朗食品">
<meta property="og:description" content="计网网络层重要知识总结">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-02-26T08:08:45.000Z">
<meta property="article:modified_time" content="2022-04-08T12:08:32.868Z">
<meta property="article:author" content="Young">
<meta property="article:tag" content="面试">
<meta property="article:tag" content="Computer Network">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2022/02/26/%E8%AE%A1%E7%BD%91-%E7%BD%91%E7%BB%9C%E5%B1%82/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2022/02/26/%E8%AE%A1%E7%BD%91-%E7%BD%91%E7%BB%9C%E5%B1%82/","path":"2022/02/26/计网-网络层/","title":"计网-网络层"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>计网-网络层 | 元朗食品</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">元朗食品</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC4%E7%AB%A0-%E7%BD%91%E7%BB%9C%E5%B1%82%E6%95%B0%E6%8D%AE%E5%B9%B3%E9%9D%A2"><span class="nav-text">第4章 网络层：数据平面</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E6%A6%82%E8%BF%B0"><span class="nav-text">4.1 网络层概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AC%E5%8F%91%E5%92%8C%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9-%E6%95%B0%E6%8D%AE%E5%B9%B3%E9%9D%A2%E5%92%8C%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2"><span class="nav-text">4.1.1 转发和路由选择:
数据平面和控制平面</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">4.2 路由器工作原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E7%AB%AF%E5%8F%A3%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E4%BA%8E%E7%9B%AE%E7%9A%84%E5%9C%B0%E8%BD%AC%E5%8F%91"><span class="nav-text">4.2.1
输入端口处理和基于目的地转发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A4%E6%8D%A2"><span class="nav-text">4.2.2 交换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E7%AB%AF%E5%8F%A3%E5%A4%84%E7%90%86"><span class="nav-text">4.2.3 输出端口处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%92%E9%98%9F"><span class="nav-text">4.2.4 排队</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E8%B0%83%E5%BA%A6"><span class="nav-text">4.2.5 分组调度</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E9%99%85%E5%8D%8F%E8%AE%AE-ipv4%E5%AF%BB%E5%9D%80ipv6"><span class="nav-text">4.3 网际协议: IPv4、寻址、IPv6</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ipv4%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F"><span class="nav-text">4.3.1 IPv4数据报格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ipv4%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%88%86%E7%89%87"><span class="nav-text">4.3.2 IPv4数据报分片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ipv4%E7%BC%96%E5%9D%80"><span class="nav-text">4.3.3 IPv4编址</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#cidr"><span class="nav-text">CIDR</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E7%B1%BB%E7%BC%96%E5%9D%80"><span class="nav-text">分类编址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA%E8%AE%BE%E5%A4%87%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E5%85%B6ip%E5%9C%B0%E5%9D%80"><span class="nav-text">一个设备如何获取其IP地址</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2nat"><span class="nav-text">4.3.4 网络地址转换NAT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ipv6%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F"><span class="nav-text">4.3.5 IPv6数据报格式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E7%94%A8%E8%BD%AC%E5%8F%91%E5%92%8Csdn"><span class="nav-text">4.4 通用转发和SDN</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC5%E7%AB%A0-%E7%BD%91%E7%BB%9C%E5%B1%82-%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2"><span class="nav-text">第5章 网络层: 控制平面</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-text">5.1 概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E7%AE%97%E6%B3%95"><span class="nav-text">5.2 路由选择算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%93%BE%E8%B7%AF%E7%8A%B6%E6%80%81%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E7%AE%97%E6%B3%95"><span class="nav-text">5.2.1 链路状态路由选择算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%9D%E7%A6%BB%E5%90%91%E9%87%8F%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E7%AE%97%E6%B3%95"><span class="nav-text">5.2.2 距离向量路由选择算法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%9D%E7%A6%BB%E5%90%91%E9%87%8F%E7%AE%97%E6%B3%95-%E9%93%BE%E8%B7%AF%E5%BC%80%E9%94%80%E6%94%B9%E5%8F%98%E4%B8%8E%E9%93%BE%E8%B7%AF%E6%95%85%E9%9A%9C"><span class="nav-text">距离向量算法:
链路开销改变与链路故障</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%9D%E7%A6%BB%E5%90%91%E9%87%8F%E7%AE%97%E6%B3%95-%E5%A2%9E%E5%8A%A0%E6%AF%92%E6%80%A7%E9%80%86%E8%BD%AC"><span class="nav-text">距离向量算法: 增加毒性逆转</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ls%E4%B8%8Edv%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E7%AE%97%E6%B3%95%E7%9A%84%E6%AF%94%E8%BE%83"><span class="nav-text">LS与DV路由选择算法的比较</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%A0%E7%89%B9%E7%BD%91%E4%B8%AD%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9F%E5%86%85%E9%83%A8%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9-ospf"><span class="nav-text">5.3
因特网中自治系统内部的路由选择: OSPF</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#isp%E4%B9%8B%E9%97%B4%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9-bgp"><span class="nav-text">5.4 ISP之间的路由选择: BGP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#bgp%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-text">5.4.1 BGP的作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E5%91%8Abgp%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF"><span class="nav-text">5.4.2 通告BGP路由信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A1%AE%E5%AE%9A%E6%9C%80%E5%A5%BD%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="nav-text">5.4.3 确定最好的路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ip%E4%BB%BB%E6%92%AD"><span class="nav-text">5.4.4 IP任播</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E7%AD%96%E7%95%A5"><span class="nav-text">5.4.5 路由选择策略</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sdn%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2"><span class="nav-text">5.5 SDN控制平面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#icmp-%E5%9B%A0%E7%89%B9%E7%BD%91%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AE"><span class="nav-text">5.6 ICMP: 因特网控制报文协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ping"><span class="nav-text">Ping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#traceroute"><span class="nav-text">TraceRoute</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%92%8Csnmp"><span class="nav-text">5.7 网络管理和SNMP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E6%A1%86%E6%9E%B6"><span class="nav-text">5.7.1 网络管理框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AEsnmp"><span class="nav-text">5.7.2 简单网络管理协议SNMP</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Young"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Young</p>
  <div class="site-description" itemprop="description">Talk is cheap, show me the code.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">122</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>


<!-- require APlayer -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">

<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<!-- require MetingJS-->

<script src="https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js"></script> 
<!--playlist外链地址-->   
<meting-js
  server="tencent"
  type="playlist" 
  id="8356942170"
  mini="false"
  fixed="false"
  list-folded="true"
  autoplay="false"
  volume="0.4"
  theme="#FADFA3"
  order="list"
  loop="all"
  preload="auto"
  lrc-type="1"
  mutex="true">
</meting-js>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/26/%E8%AE%A1%E7%BD%91-%E7%BD%91%E7%BB%9C%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Young">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="元朗食品">
      <meta itemprop="description" content="Talk is cheap, show me the code.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="计网-网络层 | 元朗食品">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          计网-网络层
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-02-26 16:08:45" itemprop="dateCreated datePublished" datetime="2022-02-26T16:08:45+08:00">2022-02-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-08 20:08:32" itemprop="dateModified" datetime="2022-04-08T20:08:32+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer-Network/" itemprop="url" rel="index"><span itemprop="name">Computer Network</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><strong>计网网络层重要知识总结</strong></p>
<span id="more"></span>
<h1 id="第4章-网络层数据平面">第4章 网络层：数据平面</h1>
<h2 id="网络层概述">4.1 网络层概述</h2>
<h3 id="转发和路由选择-数据平面和控制平面">4.1.1 转发和路由选择:
数据平面和控制平面</h3>
<ul>
<li><strong>转发</strong>，当分组到达某路由器的一条<strong>输入链路</strong>时，<strong>路由器</strong>必须将该分组移动到适当的<strong>输出链路</strong>，时间尺度是ns级，用硬件实现</li>
<li><strong>路由选择</strong>，确定分组<strong>从源到目的地</strong>所采取的端到端<strong>路径</strong>的<strong>网络范围处理过程</strong>，时间尺度是秒级，常用软件实现</li>
<li><strong>数据平面</strong>，<strong>转发</strong>是由数据平面执行的主要功能，路由器使用<strong>首部</strong>的一个或多个<strong>字段</strong>在<strong>转发表</strong>中索引，从而转发分组到相应的<strong>输出链路接口</strong></li>
<li><strong>控制平面的传统方法</strong>，<strong>路由选择算法</strong>决定了插入路由器的<strong>转发表</strong>的内容，运行在<strong>每台路由器</strong>的<strong>路由选择算法</strong>通过<strong>与其他路由器通信</strong>，计算出转发表的值</li>
<li><strong>控制平面的SDN方法</strong>，远程控制器<strong>计算</strong>和<strong>分发</strong>转发表以供每台路由器使用，<strong>远程控制器</strong>可能是现在远程数据中心中，这种方式称为<strong>软件定义网络（SDN）</strong></li>
<li>网络服务模型，可能提供的服务
<ul>
<li><strong>确保交付</strong></li>
<li><strong>具有时延上界的确保交付</strong></li>
<li><strong>有序分组交付</strong></li>
<li><strong>确保最小带宽</strong></li>
<li><strong>安全性</strong></li>
</ul></li>
<li>因特网提供<strong>尽力而为服务</strong>，即不能保证报文以发送的顺序被接收，也不能保证最终交付，不保证端到端时延，不保证有最小的带宽</li>
</ul>
<h2 id="路由器工作原理">4.2 路由器工作原理</h2>
<ul>
<li>网络层的<strong>转发</strong>功能，即将分组从一台<strong>路由器的入链路</strong>传送到合适的<strong>出链路</strong></li>
<li>路由器的<strong>四个组件</strong>：输入端口、输出端口、交换结构、路由器选择处理器
<ul>
<li><strong>输入端口</strong>，在路由器中执行终结入物理链路的物理层功能；执行查找功能，查询转发表决定路由器的输出端口</li>
<li><strong>交换结构</strong>，将路由器的输入端口连接到其输出端口，完全包含在路由器之中，即它是一个网络路由器中的网络</li>
<li><strong>输出端口</strong>，<strong>存储</strong>从交换结构接收的分组，通过执行必要的链路层和物理层功能在输出链路上传输这些分组</li>
<li><strong>路由选择处理器</strong>，执行<strong>控制平面</strong>功能，在<strong>传统路由器</strong>中执行<strong>路由选择协议</strong>，维护路由选择表与关联链路状态信息；在<strong>SDN路由器</strong>中，负责与<strong>远程控制器</strong>通信，接收由远程控制器计算的<strong>转发表</strong>，并在<strong>输入端口</strong>安装转发表</li>
</ul></li>
<li>转发的两种类型
<ul>
<li><strong>基于目的地转发</strong></li>
<li><strong>通用转发</strong></li>
</ul></li>
</ul>
<h3 id="输入端口处理和基于目的地转发">4.2.1
输入端口处理和基于目的地转发</h3>
<ul>
<li><p>输入端口的<strong>线路端接功能</strong>与<strong>链路层处理</strong>实现了用于各个输入链路的物理层和链路层</p></li>
<li><p>输入端口的<strong>查找功能</strong>是使用<strong>转发表</strong>查找<strong>输出端口</strong>，使得分组经过交换结构转发到该输出端口</p></li>
<li><p><strong>转发表</strong>是由<strong>路由选择处理器</strong>进行计算和更新的，或者接收来自<strong>远程SDN控制器</strong>的内容，从路由选择器经过独立总线复制到线路卡。因此，转发决策是在每个输入端口本地做出的，无需基于每个分组调用集中式路由选择处理器</p></li>
<li><p>路由器用分组<strong>目的地址的前缀</strong>，与该表中的表项进行匹配，如果存在匹配项，则路由器向与该匹配项相关联的链路转发分组，当存在多个匹配时，采用<strong>最长前缀匹配规则</strong></p></li>
<li><p>一旦查找<strong>确定了</strong>某分组的<strong>输出端口</strong>，则分组能够发送<strong>进入交换结构</strong>，如果来自其他输入输出端口的分组当前正在使用该交换结构，一个分组可能会在进入交换结构时被暂时<strong>阻塞</strong></p></li>
<li><p><strong>阻塞的分组</strong>必须在<strong>输入端口处排队</strong>，并等待调度进入交换结构</p></li>
<li><p>路由器的输入端口进行的工作</p>
<ul>
<li><p>最重要的是<strong>查找</strong></p></li>
<li><p>执行<strong>物理层和链路层处理</strong></p></li>
<li><p><strong>检查</strong>分组的<strong>版本号、检验和、寿命</strong>字段，并<strong>重写后两个字段</strong>（寿命字段TTL每经过一个路由器转发则递减，而检验和也必须随之重新计算）</p></li>
<li><p>更新用于<strong>网络管理的计数器</strong>，如接收到的IP数据报的数目</p></li>
</ul></li>
</ul>
<h3 id="交换">4.2.2 交换</h3>
<ul>
<li>经<strong>内存</strong>交换，最早的路由器是传统计算机，交换是在CPU的直接控制下完成的，输入与输出端口就像IO设备，交换结构就是内存。<strong>不能同时转发两个分组</strong>，因为一次仅能执行一个内存读/写</li>
<li>经<strong>总线</strong>交换，输入端口经<strong>一根共享总线</strong>将分组直接传送到输出端口，不需要路由选择处理器的干预，<strong>一次只有一个分组能够跨越总线</strong></li>
<li>经<strong>互联网络</strong>交换，纵横式交换机，有2N条总线组成互联网络，连接N个输入端口和N个输出端口。纵横式交换机能够<strong>并行转发多个分组</strong>，转发分组到某个输出端口时，只要当前没有其他分组被转发到<strong>同一个输出端口</strong>，就不会阻塞</li>
</ul>
<h3 id="输出端口处理">4.2.3 输出端口处理</h3>
<ul>
<li><strong>输出端口</strong>取出已经存放在输出端口内存中的分组，并将其发送到输出链路上，包括<strong>选择</strong>和取出<strong>排队的分组</strong>进行传输</li>
</ul>
<h3 id="排队">4.2.4 排队</h3>
<ul>
<li><strong>输入排队</strong>，<strong>线路前部阻塞（HOL）</strong>，即分组由于前部的<strong>另一个分组阻塞</strong>，而必须排队等待，<strong>即使其输出端口是空闲的</strong></li>
<li><strong>输出排队</strong>，分组在<strong>输出端口的内存中排队</strong>，如果耗尽了内存则新分组到来时，要么丢弃已到达的分组，要么删除一个或多个已排队的分组</li>
</ul>
<h3 id="分组调度">4.2.5 分组调度</h3>
<ul>
<li><p>分组调度，如何选择排队的分组，经输出链路传输的问题</p></li>
<li><p><strong>FIFO，先进先出</strong></p></li>
<li><p><strong>优先权排队</strong>，分组分类放入输出队列的优先权类，选择非空队列的<strong>最高优先权类</strong>传输一个分组，<strong>同一优先权类</strong>的分组之间的选择通常以<strong>FIFO方式</strong>完成</p></li>
<li><p><strong>循环排队规则</strong>，分组分为多类，类之间不存在服务优先权，<strong>循环调度器</strong>在这些类之间<strong>轮流提供服务</strong></p></li>
<li><p><strong>加权公平排队规则WFQ</strong>，<strong>WFQ调度器</strong>循环为各个类提供服务，每个类在同一时间可能受到不同数量的服务，即给每个类<span class="math inline">\(i\)</span>分配权<span class="math inline">\(w_i\)</span>，第<span class="math inline">\(i\)</span>类确保接收到的服务部分等于<span class="math inline">\(\frac{w_i}{\Sigma w_j}\)</span></p></li>
</ul>
<h2 id="网际协议-ipv4寻址ipv6">4.3 网际协议: IPv4、寻址、IPv6</h2>
<h3 id="ipv4数据报格式">4.3.1 IPv4数据报格式</h3>
<ul>
<li><strong>版本号(4bit)</strong>，规定了数据报的IP协议版本号</li>
<li><strong>首部长度(4bit)</strong>，因为IPv4数据报包含<strong>可变数量的选项</strong>，故使用4比特确定IP数据报中载荷开始的地方。当不包含选项时，<strong>首部长度为20字节</strong></li>
<li><strong>服务类型TOS(8
bit)</strong>，用于区分不同类型的IP数据报（如要求低时延、高吞吐量、可靠性的数据报），</li>
<li><strong>数据报长度(16bit)</strong>，IP数据报的总字节数（首部+数据）</li>
<li><strong>标识(16 bit)、标志(3 bit)、片偏移(13
bit)</strong>，与<strong>IP分片</strong>有关</li>
<li><strong>寿命TTL(8
bit)</strong>，确保数据报不会永远在网络中循环，每当一台路由器处理数据报时，该字段的值减1，<strong>当TTL字段为0，数据报必须丢弃</strong></li>
<li><strong>上层协议(8
bit)</strong>，指示IP数据报的数据部分交付给哪个<strong>运输层协议</strong>，如7表示交给TCP，17表示交给UDP</li>
<li><strong>首部检验和(16bit)</strong>，将首部中的每2个字节当作一个数，用反码对这些数求和，该和的反码存放在检验和字段，用于<strong>差错检测</strong>。每台路由器上都必须<strong>重新计算检验和</strong>，因为<strong>TTL字段</strong>及可能的选项字段<strong>会改变</strong></li>
<li><strong>源IP地址(32bit)</strong></li>
<li><strong>目的IP地址(32 bit)</strong></li>
<li><strong>选项</strong>，长度可变</li>
<li><strong>数据（有效载荷）</strong></li>
</ul>
<h3 id="ipv4数据报分片">4.3.2 IPv4数据报分片</h3>
<ul>
<li><strong>最大传送单元MTU</strong>，指一个<strong>链路层帧</strong>能够承载的<strong>最大数据量</strong>，MTU严格地限制<strong>IP数据报的长度</strong>，而且每段链路可能使用<strong>不同的链路层协议</strong>，每种协议可能有<strong>不同的MTU</strong></li>
<li>哪里分片？哪里组装？
<ul>
<li>当<strong>路由器</strong>发现出链路的MTU小于IP数据报长度时，需要将IP数据报中的数据分片成<strong>多个较小的IP数据报</strong>，用单独的链路层帧封装较小的IP数据报，然后通过链路层传送，每个较小的IP数据报称为<strong>片</strong></li>
<li>片到达目的地运输层以前需要重新组装，IPv4将数据报的<strong>重新组装</strong>工作放到<strong>端系统</strong></li>
</ul></li>
<li>标识号字段、标志字段、偏移字段的作用
<ul>
<li><strong>标识号字段</strong>：生成数据报时，发送主机为数据包设置源和目的地址的同时贴上标识号；因此，<strong>同一数据报的片具有相同的标识号字段</strong>，目的主机通过检查数据报的标识号，确定哪些数据报实际上是同一个较大数据报的片</li>
<li><strong>标志字段</strong>：初始数据报的最后一个片的<strong>标志比特设为0</strong>，用于目的主机<strong>识别数据报的最后一片</strong></li>
<li><strong>片偏移字段</strong>：指示该片<strong>在初始数据报中的位置</strong>，用于目的主机辨识片是否丢包或乱序</li>
</ul></li>
</ul>
<h3 id="ipv4编址">4.3.3 IPv4编址</h3>
<ul>
<li>接口
<ul>
<li><strong>主机或路由器</strong>到<strong>物理链路</strong>之间的边界叫做<strong>接口</strong></li>
<li>一台主机通常只有一条链路连接到网络，因此<strong>主机有一个接口</strong></li>
<li>路由器与它的任意一条链路之间的边界也叫做解耦，因此<strong>路由器有多个接口</strong></li>
<li>IP协议要求<strong>每个接口都拥有自己的IP地址</strong></li>
</ul></li>
<li>IP地址的长度是<strong>32比特、4字节</strong>，按点分十进制记法，每个接口都必须有一个全球唯一的IP地址</li>
<li>一个接口的IP地址的一部分由其连接的<strong>子网决定</strong>，IP编制为某子网分配地址为<code>223.1.1.10/24</code>，其中<code>/24</code>的记法称为<strong>子网掩码</strong>，指示32比特IP地址中的<strong>左侧24比特是子网地址</strong>，同一个子网的接口都具有<strong>相同的子网地址</strong></li>
</ul>
<h4 id="cidr">CIDR</h4>
<ul>
<li><strong>因特网</strong>的<strong>地址分配</strong>策略是<strong>无类别域间路由选择CIDR</strong></li>
<li>使用<strong>子网寻址</strong>时，32比特的IP地址分为<strong>两部分</strong>，形式为<code>a.b.c.d/x</code>，其中<code>x</code>指示了<strong>地址第一部分的比特数</strong></li>
<li><strong>最高的x比特</strong>构成了IP地址的<strong>网络部分</strong>，被称为地址的<strong>前缀</strong>（或网络前缀），一个组织通常被分配一段连续的地址，即具有相同前缀的一段地址</li>
<li>当组织<strong>外部的路由器转发</strong>时，若该数据报的目的地址位于组织内部，则只需要<strong>考虑该地址的前x比特</strong>，因此<strong>减少了路由器转发表的长度</strong></li>
<li>剩余的<strong>32-x比特</strong>用于<strong>区分组织的内部设备</strong>，当组织<strong>内部的路由器转发</strong>时，才考虑这些比特</li>
</ul>
<h4 id="分类编址">分类编址</h4>
<ul>
<li><p>CIDR之前，使用<strong>分类编址</strong>，IP地址的<strong>网络部分</strong>限制为<strong>8、16或24比特</strong></p></li>
<li><p>具有8、16或24比特的子网地址的子网分别被称为<strong>A类、B类和C类网络</strong></p></li>
<li><p><strong>缺点</strong>：B类网络的地址空间能容纳65534个接口，而C类网络的地址空间只能容纳254个接口（2个地址预留用于特殊用途），因此<strong>地址空间利用率低</strong></p></li>
<li><p><strong>IP广播地址</strong>为<code>255.255.255.255</code>，当主机发送一个目的地址为广播地址的数据报时，该报文会交付给<strong>同一个网络中的所有主机</strong>，路由器也会有选择地向邻近的子网转发该报文</p></li>
</ul>
<h4 id="一个设备如何获取其ip地址">一个设备如何获取其IP地址</h4>
<ul>
<li><strong>组织</strong>从<strong>ISP</strong>获取一块地址，用于该组织子网内的设备</li>
<li>组织内的主机获取地址，采用<strong>动态主机配置协议（DHCP）</strong>，每个子网都具有一台DHCP服务器（或DHCP中继代理），<strong>客户主机</strong>通过与<strong>DHCP服务器</strong>通信获得<strong>网络配置信息</strong>，包括<strong>IP地址、网络掩码、IP地址租用期</strong>等</li>
<li>DHCP的<strong>四个步骤</strong>
<ul>
<li><strong>Discover</strong>，主机在UDP分组中向端口67发送<strong>DHCP发现报文</strong>，生成报文的IP数据报，使用<strong>广播目的地址255.255.255.255</strong>，使用<strong>”本主机“源IP地址0.0.0.0</strong></li>
<li><strong>Offer</strong>，<strong>DHCP服务器</strong>收到DHCP发现报文，用<strong>DHCP提供报文</strong>相应，使用<strong>广播目的地址255.255.255.255</strong>，该报文包含向客户推荐的<strong>IP地址、网络掩码、IP地址租用期</strong>等信息</li>
<li><strong>Request</strong>，客户可能收到<strong>多条</strong>DHCP提供报文，从中<strong>选择一个</strong>，并向相应的DHCP服务器提供<strong>DHCP请求报文</strong>响应，回显配置参数</li>
<li><strong>ACK</strong>，DHCP服务器收到DHCP请求报文后，用<strong>DHCP
ACK报文</strong>进行响应</li>
<li>用户收到DHCP ACK报文后，就可以在租期内使用该IP地址了</li>
</ul></li>
</ul>
<h3 id="网络地址转换nat">4.3.4 网络地址转换NAT</h3>
<ul>
<li><strong>NAT使能路由器</strong>对外部来说，如同具有<strong>单一IP地址的单一设备</strong>，它对外界<strong>隐藏了</strong>家庭网络等专用网络的<strong>细节</strong></li>
<li><strong>NAT路由器</strong>维护一张<strong>NAT转换表</strong>
<ul>
<li>将专用网络中设备发送<strong>请求</strong>时，NAT路由器将IP数据报的<strong>源地址和源端口号重写</strong>，替换为<strong>广域网一侧接口的IP地址和一个新的端口号</strong>，并在NAT转换表中<strong>增加一个表项</strong></li>
<li>当对该请求的<strong>响应</strong>返回时，NAT路由器根据IP数据包的<strong>目的地址和目的端口号</strong>在<strong>NAT转换表</strong>中查找，并将IP数据报的<strong>目的地址和目的端口号重写</strong>，然后<strong>向专用网络转发该数据报</strong></li>
</ul></li>
</ul>
<h3 id="ipv6数据报格式">4.3.5 IPv6数据报格式</h3>
<ul>
<li><strong>IPv6数据报</strong>格式
<ul>
<li><strong>扩大的地址容量</strong>，128bit</li>
<li><strong>固定长度</strong>的40字节<strong>首部</strong></li>
<li><strong>流标签</strong>，用于给属于特殊流的分组加上标签，指定需要实时服务等</li>
</ul></li>
<li>从IPv4到IPv6的迁移
<ul>
<li><strong>隧道</strong>，当IPv6报文段经过IPv4设备时，将其作为IPv4报文段的数据载荷，两台IPv6路由器之间的<strong>中间IPv4路由器集合</strong>称为一个<strong>隧道</strong></li>
</ul></li>
</ul>
<h2 id="通用转发和sdn">4.4 通用转发和SDN</h2>
<ul>
<li><strong>匹配加动作表</strong>，由<strong>远程控制器</strong>为每台分组交换机计算、安装和更新</li>
<li><strong>匹配</strong>：利用来自<strong>三个层次（链路层、网络层、传输层）的首部字段</strong>进行匹配</li>
<li>动作：将分组<strong>转发</strong>到一个或多个给定的输出端口（<strong>基于目的地转发</strong>），<strong>丢弃</strong>分组（<strong>防火墙</strong>），<strong>重写</strong>所选的首部字段（<strong>NAT</strong>）等</li>
</ul>
<h1 id="第5章-网络层-控制平面">第5章 网络层: 控制平面</h1>
<h2 id="概述">5.1 概述</h2>
<ul>
<li><strong>控制平面</strong>是一种<strong>网络范围的逻辑</strong>，控制从源主机到目的主机的端到端路径间的路由器<strong>如何转发数据报</strong>，控制网络层组件和服务如何<strong>配置和管理</strong></li>
<li><strong>转发表</strong>或<strong>流表</strong>定义了一台路由器的本地<strong>数据平面</strong>转发行为</li>
<li>转发表和流表的<strong>计算、维护和安装</strong>，是控制平面的行为
<ul>
<li><strong>每路由器控制</strong>，每台路由器的<strong>路由选择组件</strong>中运行一种<strong>路由选择算法</strong>，并与其他路由器中的路由选择组件<strong>通信</strong>，以<strong>计算转发表的值</strong></li>
<li><strong>逻辑集中式控制</strong>，SDN</li>
</ul></li>
</ul>
<h2 id="路由选择算法">5.2 路由选择算法</h2>
<ul>
<li>路由选择算法的目的：从<strong>发送方</strong>到<strong>接收方</strong>的过程中，确定一条通过路由器网络的<strong>好</strong>的路径（如开销最小的路径）</li>
<li>图<span class="math inline">\(G=(N,E)\)</span>是一个N个节点和E条边的集合，其中每条边是取自<span class="math inline">\(N\)</span>的一对节点，在网络层路由选择中，<strong>节点</strong>表示<strong>路由器</strong>，<strong>边</strong>表示路由器之间的<strong>物理链路</strong></li>
<li><strong>最短路径</strong>，指在源和目的地之间具有<strong>最少链路数量</strong>的路径</li>
<li>按集中式和分散式划分
<ul>
<li><strong>集中式</strong>路由选择算法，用完整的、全局性的网络知识计算出从源到目的地之间的最低开销路径，该算法以所有节点之间的连通性及所有链路的开销为输入，计算可在某个场点（逻辑集中式控制器）进行。具有全局状态信息的算法常被称作<strong>链路状态（LS）算法</strong></li>
<li><strong>分散式</strong>路由选择算法，</li>
</ul></li>
<li>按<strong>静态/动态</strong>划分</li>
<li>按<strong>负载敏感/负载迟钝</strong>划分</li>
</ul>
<h3 id="链路状态路由选择算法">5.2.1 链路状态路由选择算法</h3>
<ul>
<li><p><strong>链路状态（LS）算法</strong>中，<strong>网络拓扑</strong>和所有链路的<strong>开销已知</strong></p></li>
<li><p>Dijkstra算法</p></li>
<li><p>算法终止时，可以计算出从<strong>源节点</strong>到网络中<strong>每个其他节点</strong>的<strong>最短路径长度</strong><span class="math inline">\(D(i)\)</span>，且对于每个节点都得到从源节点沿着它的<strong>最低开销路径的前一节点</strong><span class="math inline">\(P(i)\)</span>，因此可以构建从源节点到其他节点的最低开销<strong>完整路径</strong></p></li>
<li><p>LS算法可能存在的<strong>问题</strong>：<strong>振荡</strong></p></li>
</ul>
<h3 id="距离向量路由选择算法">5.2.2 距离向量路由选择算法</h3>
<ul>
<li><strong>距离向量（DV）算法</strong>是一种<strong>迭代</strong>、<strong>异步</strong>和<strong>分布式</strong>的算法，而LS算法是一种使用全局信息的算法
<ul>
<li>DV算法的<strong>分布式</strong>体现在，每个节点都要从一个或多个<strong>直接相连邻居接收信息</strong>，执行<strong>计算</strong>，将计算<strong>结果分发</strong>给邻居</li>
<li>DV算法的<strong>迭代</strong>体现在，此过程一直<strong>持续到邻居之间无更多信息要交换</strong>为止</li>
<li>DV算法的<strong>异步</strong>体现在，它<strong>不要求</strong>所有节点相互之间<strong>步伐一致地操作</strong></li>
</ul></li>
<li><strong>Bellman-Ford方程</strong>，令<span class="math inline">\(d_x(y)\)</span>为从节点x到节点y的最低开销路径的开销，则有</li>
</ul>
<p><span class="math display">\[
d_x(y)=min_v\{c(x,v)+d_v(y)\}
\]</span></p>
<ul>
<li><p>Bellman-Ford方程的作用</p>
<ul>
<li><strong>为节点<span class="math inline">\(x\)</span>的转发表提供了表项</strong>，假设<span class="math inline">\(v*\)</span>是取得上述方程最小值的<span class="math inline">\(x\)</span>的相邻节点，则<span class="math inline">\(x\)</span>的转发表将指定<span class="math inline">\(v*\)</span>作为目的地y的下一跳路由器</li>
<li>它提出了<strong>邻居到邻居通信方式</strong></li>
</ul></li>
<li><p><strong>距离向量</strong>，指从<span class="math inline">\(x\)</span>到在N中的所有其他节点<span class="math inline">\(y\)</span>的<strong>开销估计</strong>向量，<span class="math inline">\(D_x=[D_x(y):y \in N]\)</span></p></li>
<li><p><strong>DV算法</strong>中，每个节点<span class="math inline">\(x\)</span>维护以下信息</p>
<ul>
<li>对于每个邻居<span class="math inline">\(v\)</span>，从<strong><span class="math inline">\(x\)</span>到直接邻居<span class="math inline">\(v\)</span>的开销</strong>为<span class="math inline">\(c(x,v)\)</span></li>
<li><strong>节点<span class="math inline">\(x\)</span>的距离向量</strong>，即<span class="math inline">\(D_x=[D_x(y):y \in N]\)</span>，包含了<span class="math inline">\(x\)</span>到<span class="math inline">\(N\)</span>中所有目的地<span class="math inline">\(y\)</span>的开销的<strong>估计值</strong></li>
<li><strong>节点<span class="math inline">\(x\)</span>的每个邻居的距离向量</strong></li>
</ul></li>
<li><p>DV算法中，每个节点不定时地向它的每个邻居发送它的距离向量副本，若<span class="math inline">\(x\)</span>收到它的任一邻居<span class="math inline">\(w\)</span>的距离向量，则</p>
<ul>
<li>保存邻居<span class="math inline">\(w\)</span>的距离向量</li>
<li>使用Bellman-Ford公式更新自己的距离向量，即计算<span class="math inline">\(D_x(y)=min_v\{c(x,v)+D_v(y)\}\)</span>，在此过程中求得<span class="math inline">\(v^*(y)\)</span>并<strong>更新</strong><span class="math inline">\(x\)</span>中目的地<span class="math inline">\(y\)</span>的<strong>转发表</strong></li>
<li>如果上述过程中<span class="math inline">\(x\)</span>的距离向量更新了，则将<strong>更新后的距离向量</strong>发送给<strong>所有邻居</strong></li>
<li>此外，如果<span class="math inline">\(x\)</span>发现到直接相邻邻居的<strong>链路开销<span class="math inline">\(c(x,v)\)</span>发生了变化</strong>，也会<strong>更新自己的距离向量</strong>，并<strong>发送给所有邻居</strong></li>
</ul></li>
<li><p>只要所有节点继续以异步方式交换它们的距离向量，每个开销估计<strong><span class="math inline">\(D_x(y)\)</span>最终将收敛</strong>到<span class="math inline">\(d_x(y)\)</span></p></li>
<li><p>DV算法与LS算法的对比</p>
<ul>
<li><p><strong>LS</strong>算法是<strong>全局</strong>算法，在运行Dijkstra算法前每个节点都要获得该网络的完整信息</p></li>
<li><p><strong>DV</strong>算法是<strong>分布式</strong>的，每个节点只拥有到<strong>直接相邻邻居的链路开销</strong>，和<strong>从这些邻居接收到的信息</strong>，得到了<strong>广泛应用</strong></p></li>
</ul></li>
<li><p><strong>DV算法</strong>的伪代码表示</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Initialization:</span><br><span class="line">    <span class="keyword">for</span> all destination y in N:</span><br><span class="line">		<span class="built_in">Dx</span>(y)=<span class="built_in">c</span>(x, y)  <span class="comment">// if y is not a neighbor then c(x,y)=infinity</span></span><br><span class="line">    <span class="keyword">for</span> each neighbor w:</span><br><span class="line">    	<span class="built_in">Dw</span>(y)=? <span class="keyword">for</span> all destination y in N</span><br><span class="line">    <span class="keyword">for</span> each neighbor w:</span><br><span class="line">    	send distance vector Dx = [<span class="built_in">Dx</span>(y): y in N] to w</span><br><span class="line">loop</span><br><span class="line">    <span class="built_in">wait</span> (until I see a link cost change to some neighbor w <span class="keyword">or</span></span><br><span class="line">          until I receive a distance vector from some neighbor w)</span><br><span class="line">    <span class="keyword">for</span> each y in N:</span><br><span class="line">    	<span class="built_in">Dx</span>(y) = minv&#123;<span class="built_in">c</span>(x,v)+<span class="built_in">Dv</span>(y)&#125;</span><br><span class="line">    	<span class="comment">// find v* and update forwarding table</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">Dx</span>(y) changed <span class="keyword">for</span> any destination y</span><br><span class="line">	send distance vector Dx = [<span class="built_in">Dx</span>(y): y in N] to all neighbors</span><br><span class="line">forever</span><br></pre></td></tr></table></figure></li>
<li><p>从邻居接收更新距离向量、重新计算路由选择表项、通知邻居到目的地的最低开销路径的开销已经变化的过程将不断继续，直至无更新报文发送为止。此时，算法进入<strong>静止状态</strong>，直到<strong>一条链路开销发生改变</strong></p></li>
</ul>
<h4 id="距离向量算法-链路开销改变与链路故障">距离向量算法:
链路开销改变与链路故障</h4>
<ul>
<li><strong>路由选择环路</strong>，即分组在路由之间<strong>环路传播</strong>，无法到达目的地</li>
<li><strong>无穷计数</strong>：链路开销改变传播得很慢，需要经过<strong>非常多次迭代</strong></li>
</ul>
<h4 id="距离向量算法-增加毒性逆转">距离向量算法: 增加毒性逆转</h4>
<ul>
<li>无法解决无穷计数问题，只有在特定循环的场景中（如两个节点之间循环）才有效</li>
</ul>
<h4 id="ls与dv路由选择算法的比较">LS与DV路由选择算法的比较</h4>
<ul>
<li><strong>报文复杂性</strong>
<ul>
<li>LS算法要求每个节点都知道网络中每条链路的开销，因此要发送<span class="math inline">\(O(NE)\)</span>条报文</li>
<li>DV算法每次迭代时都在两个直接相邻邻居之间交换报文</li>
</ul></li>
<li><strong>收敛速度</strong>
<ul>
<li>LS算法是Dijkstra算法，时间复杂度是<span class="math inline">\(O(N^2)\)</span>，经堆优化可以是<span class="math inline">\(O(NlogN)\)</span></li>
<li>DV算法可能遭遇无穷计数问题</li>
</ul></li>
<li><strong>健壮性</strong>
<ul>
<li>LS算法的路由计算在某种程度上是分离的，有一定健壮性</li>
<li>DV算法中一个不正确的节点计算值会扩散到整个网络</li>
</ul></li>
</ul>
<h2 id="因特网中自治系统内部的路由选择-ospf">5.3
因特网中自治系统内部的路由选择: OSPF</h2>
<ul>
<li>将路由器组织进<strong>自治系统AS</strong>，通常在<strong>一个ISP</strong>中的路由器与互联它们的链路<strong>构成一个AS</strong></li>
<li>在相同AS中的路由器都运行<strong>相同的路由选择算法</strong>并有彼此的信息，在一个<strong>自治系统内</strong>运行的路由选择算法叫做<strong>自治系统内部路由选择协议</strong></li>
<li><strong>开放最短路优先OSPF</strong>，是一种链路协议，使用<strong>洪泛链路状态信息</strong>和<strong>Dijkstra</strong>最低开销路径算法</li>
<li>OSPF的<strong>特点</strong>如下
<ul>
<li><strong>每台路由器</strong>本地运<strong>行Dijkstra最短路径算法</strong></li>
<li>链路<strong>开销</strong>是由<strong>网络管理员配置</strong>的</li>
<li>路由器向自治系统中的所有其他路由器<strong>广播</strong>路由选择信息，即<strong>洪泛法</strong></li>
<li>每当<strong>链路状态发生改变</strong>时，路由器就<strong>广播</strong>信息；此外，如果链路状态<strong>没有变化</strong>，也会<strong>周期</strong>性地广播</li>
</ul></li>
</ul>
<h2 id="isp之间的路由选择-bgp">5.4 ISP之间的路由选择: BGP</h2>
<ul>
<li>分组在AS内的路径完全遵守<strong>自治系统内部路由选择协议</strong>，当分组跨越多个AS进行路由时，需要一个<strong>自治系统间路由选择协议</strong></li>
<li>所有AS通信必须运行相同的自治系统间路由选择协议，称为<strong>边界网关协议（BGP）</strong></li>
</ul>
<h3 id="bgp的作用">5.4.1 BGP的作用</h3>
<ul>
<li>BGP中，分组路由到CIDR化的前缀，每个<strong>前缀</strong>表示<strong>一个子网或一个子网的集合</strong>，目的的可采用如138.16.68/22的形式，路由器转发表将具有<span class="math inline">\((x,I)\)</span>的表项，其中<span class="math inline">\(x\)</span>为<strong>前缀</strong>，<span class="math inline">\(I\)</span>是<strong>该路由器的接口之一的接口号（输出端口）</strong></li>
<li>BGP中每台路由器的<strong>两个任务</strong>
<ul>
<li>从<strong>邻居AS</strong>获得<strong>前缀的可达性信息</strong>，BGP允许每个子网向因特网的其余部分通告其存在</li>
<li>确定到该前缀的<strong>最好的路由</strong>，路由器可能直到多条到特定前缀的不同路由，路由器<strong>本地</strong>运行的<strong>BGP路由选择算法</strong>将计算最好路由（使用经过<strong>相邻路由器</strong>获得的<strong>前缀可达性信息</strong>）</li>
</ul></li>
</ul>
<h3 id="通告bgp路由信息">5.4.2 通告BGP路由信息</h3>
<ul>
<li>对于每个AS，每台路由器要么是<strong>网关路由器</strong>，要么是<strong>内部路由器</strong>。网关路由器是一台位于<strong>AS边缘</strong>的路由器，它直接<strong>连接到在其他AS</strong>中的一台或多台路由器</li>
<li>路由器<strong>通告对于前缀<span class="math inline">\(x\)</span>的可达性信息</strong>，<span class="math inline">\(x\)</span>是AS3内部某个子网的前缀，AS3向AS2发送BGP报文，告知<span class="math inline">\(x\)</span>位于AS3中，该报文表示为<code>AS3 x</code>，AS2向AS1发送BGP报文，告知<span class="math inline">\(x\)</span>存在并且能通过AS2然后进入AS3进而到达<span class="math inline">\(x\)</span>，报文表示为<code>AS2 AS3 X</code></li>
<li>BGP中，每对路由器通过<strong>端口179</strong>的<strong>半永久TCP连接</strong>交换路由选择信息，通过该连接发送的BGP报文称为BGP连接</li>
<li><strong>跨越两个AS</strong>的BGP连接称为<strong>外部BGP连接(eBGP)</strong>，<strong>同一AS中</strong>两台路由器间的BGP连接称为<strong>内部BGP连接(iBGP)</strong></li>
<li>直接连接在<strong>不同AS</strong>的<strong>网关路由器</strong>的链路，通常有一条<strong>eBGP连接</strong>；AS中的路由器还有多条iBGP连接，一种常用配置是<strong>AS内部的每对路由器之间有一条iBGP</strong></li>
</ul>
<h3 id="确定最好的路由">5.4.3 确定最好的路由</h3>
<ul>
<li><strong>前缀</strong>及其<strong>BGP属性</strong>称为<strong>路由</strong></li>
<li>BGP属性包括<strong>AS-PATH、NEXT-HOP</strong>等
<ul>
<li><strong>NEXT-HOP</strong>，<strong>AS-PATH起始的路由器</strong>接口的IP地址</li>
<li><strong>AS-PATH</strong>，包含了通告已经通过的<strong>AS的列表</strong>，当一个前缀经过某AS时，它<strong>将自己的ASN加入AS-PATH的现有列表</strong>中</li>
<li>BGP路由器使用AS-PATH属性<strong>检测和防止通告环路</strong>，如在路径列表中就看到<strong>包含了自己的AS</strong>，将<strong>拒绝该通告</strong></li>
</ul></li>
<li><strong>热土豆路由选择</strong>
<ul>
<li>路由器在到达某前缀<span class="math inline">\(x\)</span>的多条BGP路由中，选择从自己到该路由的<strong>NEXT-HOP路由器</strong>具有<strong>最小开销</strong>的一条</li>
<li>其思想是<strong>尽可能快地将分组传给另一个AS
(greedy)</strong>，减小在自己AS中的开销，忽略在其他AS之外的端到端开销的其他部分</li>
<li>路由器进行热土豆路由选择后，查阅其转发表找到通往所选路由的<strong>NEXT-HOP路由器</strong>的<strong>最低开销路径</strong>上的接口<span class="math inline">\(I\)</span>，并<strong>把<span class="math inline">\((x,I)\)</span>加入到转发表中</strong></li>
</ul></li>
<li>在路由器<strong>转发表</strong>中增加<strong>AS外部前缀</strong>的步骤
<ul>
<li>从AS间协议学到经多个网关可到达子网<span class="math inline">\(x\)</span>（BGP报文）</li>
<li>使用来自AS内部协议的路由选择信息（OSPF），决定到达每个网关的最低开销路径的开销</li>
<li>热土豆路由选择，选择具有最小最低开销的网关</li>
<li>从转发表确定通过最低开销网关的接口<span class="math inline">\(I\)</span>，在转发表中加入表项<span class="math inline">\((x,I)\)</span></li>
</ul></li>
<li><strong>BGP路由器选择算法</strong>
<ul>
<li>路由器包含<strong>本地偏好值属性</strong>，这是一种策略决定，完全取决于该AS的<strong>网络管理员</strong>。具有最高本地偏好值的路由将被选择</li>
<li>若有多条路由具有本地偏好值，则选择具有<strong>最短AS-PATH</strong>的路由</li>
<li>若仍有多条路由可选，使用热土豆路由选择，选择具有<strong>最小到NEXT-HOP路由器最低开销</strong>的路由</li>
<li>若仍有多条路由可选，则使用BGP标识符选择路由</li>
</ul></li>
</ul>
<h3 id="ip任播">5.4.4 IP任播</h3>
<ul>
<li><strong>IP任播</strong>用于
<ul>
<li>完成在许多分散的不同物理位置，替换不同服务器上的相同内容</li>
<li><strong>让每个用户从最靠近的服务器访问内容</strong></li>
</ul></li>
<li>IP任务实现“让每个用户从最靠近的服务器访问内容”的过程
<ul>
<li>将<strong>多台物理位置不同的服务器</strong>分配<strong>相同的IP地址</strong></li>
<li>使用标准的BGP<strong>从每台服务器通告该IP地址</strong></li>
<li>当路由器收到对该IP地址的多个路由通告时，它将其<strong>视为相同的物理地址</strong>提供的不同路由（实际上是对不同物理地址提供的不同路由）</li>
<li>路由器本地运行的BGP路由选择算法，将选择到该IP地址的最好的路由，实际上就从具有相同IP地址的服务器中，<strong>选择了距离该路由器最近的服务器</strong></li>
</ul></li>
</ul>
<h3 id="路由选择策略">5.4.5 路由选择策略</h3>
<ul>
<li>任何穿越ISP主干网的流量，必须满足其<strong>源或目的位于该ISP的某个客户网络</strong>，防止其他流量“<strong>免费搭车</strong>”</li>
</ul>
<blockquote>
<p>为什么<strong>不同AS之间</strong>和<strong>AS内部</strong>的路由选择协议<strong>不同</strong>？</p>
<ul>
<li>策略，在AS之间的路由选择，策略是最重要的，BGP首先根据本地偏好值进行选择；而AS内部是在相同的管理控制名义下进行的，策略问题微不足道</li>
<li>规模</li>
<li>性能，AS间的路由选择是面向策略的，性能是次要关心的问题；而AS内部对策略不关心，通过OSPF可以最大限度地提高性能</li>
</ul>
</blockquote>
<h2 id="sdn控制平面">5.5 SDN控制平面</h2>
<ul>
<li>略</li>
</ul>
<h2 id="icmp-因特网控制报文协议">5.6 ICMP: 因特网控制报文协议</h2>
<ul>
<li>因特网控制报文协议ICMP，被主机和路由器用来彼此沟通网络层的信息</li>
<li>ICMP的典型用途是<strong>差错报告</strong>，IP路由器<strong>不能找到</strong>通往HTTP请求中<strong>目的主机的路径</strong>时，将生成并<strong>向源主机发送一个ICMP报文</strong>以指示错误</li>
<li><strong>ICMP报文</strong>作为<strong>IP数据报的有效载荷</strong>被承载</li>
</ul>
<h3 id="ping">Ping</h3>
<ul>
<li><strong>Ping</strong>（Packet Internet
Groper），即<strong>因特网包探测器</strong>，是一种工作在网络层的服务命令，主要用于测试网络连接量。本地主机通过向目的主机发送
<strong>ICMP Echo 请求报文</strong>，目的主机收到之后会发送 <strong>Echo
响应报文</strong>，Ping
会根据时间和成功响应的次数估算出数据包<strong>往返时间</strong>以及<strong>丢包率</strong>从而推断网络是否通畅、运行是否正常等</li>
</ul>
<h3 id="traceroute">TraceRoute</h3>
<ul>
<li><strong>Traceroute</strong>，TraceRoute 是 ICMP
的另一个应用，主要用来跟踪一个分组<strong>从源点耗费最少 TTL
到达目的地的路径</strong></li>
<li>源主机向目的的主机发送一系列IP数据报，携带了一个具有不可达UDP端口号的UDP报文段，<strong>第一个数据报的TTL为1，此后每个递增1</strong></li>
<li>当第i个数据报到达第i个路由器时，该数据报TTL变为0，因此它<strong>丢弃该数据报</strong>，并发送<strong>ICMP告警报文</strong>给源主机</li>
<li>源主机得到返回的<strong>ICMP告警报文</strong>，得到了该<strong>路由器的IP地址</strong>，以及<strong>到该路由器的往返时延</strong></li>
<li>最终，某个数据报到达目的主机，由于数据报的UDP报文段具有<strong>不可达的UDP端口号</strong>，因此<strong>目的主机</strong>将向源主机发送一个<strong>端口不可达的ICMP报文</strong></li>
</ul>
<h2 id="网络管理和snmp">5.7 网络管理和SNMP</h2>
<h3 id="网络管理框架">5.7.1 网络管理框架</h3>
<ul>
<li><strong>管理服务器</strong>，运行在网络运营中心的集中式网络管理工作站上的一个<strong>应用程序</strong>，控制<strong>网络管理信息</strong>的<strong>收集、处理、分析和显示</strong></li>
<li><strong>被管设备</strong>，网络设备的一部分，位于被管理的网络中，被管设备包含几个<strong>被管对象</strong>，对应设备中<strong>硬件的实际部分</strong></li>
<li><strong>管理信息库</strong>，一个被管设备的<strong>每个被管对象</strong>的<strong>关联信息收集</strong>在<strong>管理信息库MIB</strong>中，这些信息的值可<strong>供管理服务器所用</strong></li>
<li><strong>网络管理代理</strong>，每个<strong>被管设备中</strong>驻留有网络管理代理，运行在被管设备中的一个进程，负责<strong>与管理服务器通信</strong></li>
<li><strong>网络管理协议</strong>，运行在管理服务器和被管设备之间，允许管理服务器查询被管设备的状态，并经过代理间接地在设备上采取行动；代理向管理服务器通知异常事件</li>
</ul>
<h3 id="简单网络管理协议snmp">5.7.2 简单网络管理协议SNMP</h3>
<ul>
<li>略</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Young
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://example.com/2022/02/26/%E8%AE%A1%E7%BD%91-%E7%BD%91%E7%BB%9C%E5%B1%82/" title="计网-网络层">http://example.com/2022/02/26/计网-网络层/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag"># 面试</a>
              <a href="/tags/Computer-Network/" rel="tag"># Computer Network</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/02/25/C++-%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E5%AE%9E%E7%8E%B0/" rel="prev" title="C++ 信号量的实现">
                  <i class="fa fa-chevron-left"></i> C++ 信号量的实现
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/02/28/%E8%AE%A1%E7%BD%91-%E9%93%BE%E8%B7%AF%E5%B1%82/" rel="next" title="计网-链路层">
                  计网-链路层 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Young</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  




  <script src="/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
