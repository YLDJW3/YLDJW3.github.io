---
title: OS 面试题
date: 2022-02-17 19:55:34
tags: 
    - OS
    - 面试
mathjax: true
categories: OS
---

**OS常考面试题总结**

<!--more-->

# 基本概念

## 操作系统是什么？

- 操作系统是运行在计算机上最重要的一种软件，它**负责管理计算机硬件和软件资源**，为计算机硬件和软件提供了一个**中间层**

![](1.png)

## 内核与外壳分别是什么？

- 内核就是能操作硬件的程序，内核**管理系统的进程、内存、设备驱动程序、文件、网络**等，决定着系统的性能和稳定性
- 外壳就是围绕内核的**应用程序**

## 用户态与内核态是什么？

- 根据**进程访问资源**的特点，我们可以把进程在系统上的运行分为两个级别：
  - **用户态**`(user mode)`: 用户态运行的进程可以直接**读取用户程序的数据**
  - **系统态**`(kernel mode)`: 可以简单的理解系统态运行的进程或程序**几乎可以访问计算机的任何资源，不受限制**

## 什么是系统调用？有哪几类？

- 我们运行的程序基本都是运行在**用户态**，如果需要调用操作系统提供的内核态级别的功能的时候，就需要使用系统调用，**通过系统调用方式向操作系统提出服务请求**，并由操作系统代为完成
- 分为以下几类
  - **设备管理**，完成设备的请求或释放，以及设备启动等功能
  - **文件管理**，完成文件的读、写、创建及删除等功能
  - **进程控制**，完成进程的创建、撤销、阻塞及唤醒等功能
  - **进程通信**，完成进程之间的消息传递或信号传递等功能
  - **内存管理**，完成内存的分配、回收以及获取作业占用内存区大小及地址等功能

## 如何从用户态切换到内核态？有哪几种方式？

- **系统调用**，用户态进程通过系统调用申请使用操作系统提供的服务程序完成工作
- **异常**，当CPU在执行运行在用户态下的程序时，发生了某些事先不可知的异常，这时会触发由当前运行进程**切换到处理此异常的内核相关程序**中
- **设备中断**，当**外围设备完成用户请求的操作后，会向CPU发出相应的中断信号**，这时CPU会暂停执行下一条即将要执行的指令转而去执行与中断信号对应的处理程序，如果先前执行的指令是用户态下的程序，那么这个转换的过程自然也就发生了由用户态到内核态的切换。比如硬盘读写操作完成，系统会切换到硬盘读写的中断处理程序中执行后续操作等

## 并行与并发有何区别？

- **并发**：在操作系统中，某一时间段，几个程序在同一个CPU上运行，但**在任意一个时间点上，只有一个程序在CPU上运行**
- **并行**：两个程序在某一时刻同时运行，强调**同时发生**

## 操作系统有哪几种结构？分别是怎样的？

- **宏内核**的特征是**系统内核的所有模块**，比如进程调度、内存管理、文件系统、设备驱动等，**都运行在内核态**
- **微内核**，微内核架构的**内核只保留最基本的能力**，比如**进程调度、虚拟机内存、中断**等，把一些应用放到了用户空间，比如驱动程序、文件系统等。这样服务与服务之间是隔离的，单个服务出现故障或者完全攻击，也不会导致整个操作系统挂掉，提高了操作系统的稳定性和可靠性
- **混合类型内核**，它的架构有点像微内核，内核里面会有一个最小版本的内核，然后其他模块会在这个基础上搭建，然后实现的时候会跟宏内核类似，也就是把整个内核做成一个完整的程序，大部分服务都在内核中，这就像是宏内核的方式包裹着一个微内核

# 进程管理

## 进程概念

- 进程实体由哪几部分组成？
- 进程控制块PCB包含什么信息？

- 进程有哪些状态，状态切换是怎样的？

- 进程控制包含哪些操作？

- 进程切换是如何进行的？

- xv6中的**进程切换**是怎样进行的？

- xv6中context switch时候的操作

  保存旧线程的寄存器（PC、栈指针）

  恢复新线程之前保存的寄存器值

- 进程通信的方式

  PV操作

  共享存储

  消息传递

  管道通信

## 线程概念

- 进程和线程的区别是什么？
- 线程的实现方式有哪些？

## 进程调度算法

- 调度的三个层次是什么？
- 进程调度的非剥夺和剥夺方式是什么？
- 调度算法有哪几种？
- 进程调度的多级反馈队列是怎样的？

## 进程同步

- 什么是临界资源和临界区

- 对临界资源的访问过程可分为哪四个部分

- 什么是进程同步？什么是进程互斥？

- 如何实现临界区互斥访问？信号量机制是怎样的？

- 什么是管程？

- 生产者消费者问题如何解决？

  ```c++
  std::mutex mtx;
  Semaphore empty(N);
  Semaphore full(0);
  // 生产者
  mtx.lock();
  P(empty);
  V(full);
  mtx.unlock();
  
  // 消费者
  mtx.lock();
  P(full);
  V(empty);
  mtx.unlock();
  ```

- **读者写者问题**如何解决?

  ```c++
  std::mutex mtx1;
  int readers = 0;
  std::mutex mtx2;
  // reader
  mtx1.lock();
  if (readers == 0)
      mtx2.lock();
  ++readers;
  mtx1.unlock();
  read();
  mtx1.lock();
  --readers;
  if (readers == 0)
      mtx2.unlock();
  mtx1.unlock();
  
  // writer
  mtx2.lock();
  write();
  mtx2.unlock();
  ```

  以上方法存在公平性问题，写进程可能饿死

- 哲学家进餐问题如何解决?

  - **限制人数**：规定进餐人数小于4人
  - **制定规则**：如奇数编号先拿左手、偶数编号先拿右手

- C++如何实现信号量机制？

  ```c++
  class Semaphore {
  private:
      std::mutex mtx_;
      int source_;
      std::conditional_variable cv_;
  public:
      Semaphore(int s): source_(s) {}
  
      void acquire() {
          std::unique_lock<std::mutex> guard(mtx_);
          while (source_ <= 0) {
              cv_.wait(guard);
          }
          --source_;
      }
  
      void release() {
          std::unique_lock<std::mutex>(mtx_);
          ++source_;
          cv_.notify_all();
      }
  };
  ```

## 死锁

- 死锁的四个必要条件是什么？
- 死锁的处理方法有哪些？
- 死锁预防有哪些方法？
- 死锁检测与死锁恢复有哪些方法？
- 死锁避免方法是怎样的？

# 内存管理

## 内存管理策略

### 基本概念

- 内存空间保护是怎样实现的？
- 内存调度是什么？
- 地址绑定的方式有哪几种？
- 逻辑地址空间与物理地址空间是什么？
- 内存管理单元MMU有何作用？

### 交换

- 什么是交换？
- 标准交换过程是怎样的？
- 换出进程有何要求？

### 连续内存分配

- 什么是固定分区的内存分配
- 什么是可变分区的内存分配
- 什么是碎片？外部碎片？内部碎片？

### 分段

- 什么是分段内存分配？
- 分段内存分配中，逻辑地址是怎样的？
- 段表是什么，其表项包括什么？
- 什么是非法的逻辑地址？

### 分页

- 帧、页、块的概念
- 逻辑地址的组成
- 页表的作用
- 进程如何维护其页表
- TLB的作用是什么
- 什么是分层分页，有何优点
- xv6中的分层分页是怎样的

## 虚拟内存管理

- 什么是虚拟内存？有何作用？

### Demanding paging

- 什么是Demanding paging技术？
- 当进程请求处在外存的页面时，会发生什么？
- 为了支持Demanding paging，操作系统需要维护什么额外状态？

### copy on write

- 什么是写时复制技术？请描述详细过程

### 页面置换

- 页面置换算法有哪些？
- 什么是局部性原理？

# 文件管理

## 文件系统基础

- 文件的基本操作包括哪些？
- 什么是打开文件表，两级的打开文件表是什么？
- 文件的关联信息有哪些？
- 文件锁有哪两种，文件锁机制有哪两种？
- 文件的逻辑结构有哪几种？
- 什么是文件控制块，包含哪些信息？
- 什么是索引节点，为什么设置索引节点？
- 什么是文件目录，为什么需要文件目录？
- 目录结构有哪几种？
- 对文件目录的操作有哪些？
- 文件共享有哪两种方式？分别有何特点？
- 如何实现文件保护？

## 文件系统实现

- 文件系统层次结构是怎样的？
- 请描述进程访问某个文件的完整过程？
- 文件目录有哪两种实现方式？
- 文件分配方式有哪几种?

## 磁盘组织和管理

- 磁盘结构是怎样的？
- 读写磁盘块的时间由哪几部分组成，其中哪部分是优化的关注点？
- 磁盘调度算法有哪几种？



# I/O管理

- 阻塞IO

- 非阻塞IO

- **IO多路复用**

  - select

    将一个文件描述符数组通过select调用传递给内核，内核遍历该数组并确定哪个文件描述符可读写，然后返回

    select系统调用返回后，遍历该文件描述符数组，如已就绪则进行读/写

    **缺点**

    - 文件描述符数量最大值限制为1024
    - 需要将文件描述符数组从用户态拷贝到内核态
    - 对文件描述符采用线性扫描方式，效率有可提升空间

  - poll

    文件描述符数量无限制

  - epoll

    - 在内核中保存一份文件描述符集合，用户可以通过接口添加、修改、删除文件描述符
    - 内核中通过异步IO事件唤醒的方式，得到就绪的文件描述符
    - 内核只将有IO事件的文件描述符返回给用户，用户无需遍历整个文件描述符集合
    - 内核中的文件描述符通过红黑树的方式进行组织

- 信号驱动IO

- 异步IO
