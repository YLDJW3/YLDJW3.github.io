---
title: 6.824 Lab 2
date: 2021-12-14 01:44:08
tags: 6.824
---

# Part 2A: leader election

- 论文Figure2的**每一句话都必须严格遵守**，否则就无法通过测试

  ![](figure2.png)

- leader的heartbeat间隔为100ms，election timer的间隔可设为300-600ms

- Election timer的**reset时机**有且只有三个
  - 收到来自当前leader的**有效心跳信号**
  - **为其他server投票时**
  - timeout，并且**成为candidate开始竞选时**
  
- RPC的接收者或发出者，只要遇到`args`或`reply`的`Term`大于自己的`currentTerm`，就要更新`currentTerm`，重新设置`VotedFor`，并成为follower

- 参与竞选时，candidate应立刻vote for self，更新`VotedFor`和`receivedVotes`，之后发送`RequestVote RPC`时应跳过自己

- candidate参与竞选时的动作顺序应严格遵守Figure2

- 困扰我最大的bug是，candidate发送`RequestVote`，以及leader发送`AppendEntries`都应该是**并行**的，切勿在循环中串行发送，否则等待RPC返回的时间加起来，大概率超过Election timer的timeout
